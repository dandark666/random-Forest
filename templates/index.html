<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Malware en Android</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
            margin-bottom: 40px;
        }
        .stat-card {
            border-left: 4px solid #007bff;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .data-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        .model-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                üìä An√°lisis de Malware <span class="data-badge">DATOS REALES</span>
            </a>
        </div>
    </nav>

    <div class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-4">An√°lisis de Dataset de Malware Android</h1>
            <p class="lead mb-4">Decision Forest - CICAndMal2017</p>
            <div class="alert alert-success alert-dismissible fade show" style="max-width: 600px; margin: 0 auto;">
                <strong>‚úÖ Dataset cargado correctamente</strong> - {{ stats.data_length|floatformat:0 }} registros analizados
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Estad√≠sticas Principales -->
        <div class="row mb-5">
            <div class="col-md-4 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">üìä Total de Registros</h5>
                        <h2 class="text-primary">{{ stats.data_length|floatformat:0 }}</h2>
                        <p class="card-text">Muestras en el dataset</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">üîß Caracter√≠sticas</h5>
                        <h2 class="text-success">{{ stats.feature_count }}</h2>
                        <p class="card-text">Features analizadas</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">üéØ Clases</h5>
                        <h2 class="text-warning">3</h2>
                        <p class="card-text">Tipos de aplicaciones</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informaci√≥n Decision Forest -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card model-card h-100">
                    <div class="card-body text-center">
                        <h4 class="card-title">üéØ Decision Forest</h4>
                        <div class="row mt-4">
                            <div class="col-6">
                                <h5 class="text-warning">0.9812</h5>
                                <p class="mb-0">F1 Score Train</p>
                            </div>
                            <div class="col-6">
                                <h5 class="text-warning">0.9304</h5>
                                <p class="mb-0">F1 Score Validation</p>
                            </div>
                        </div>
                        <p class="mt-3 mb-0">√Årbol de decisi√≥n individual para clasificaci√≥n</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <div class="card-body text-center">
                        <h4 class="card-title">üå≤ Random Forest</h4>
                        <div class="row mt-4">
                            <div class="col-6">
                                <h5 class="text-warning">100</h5>
                                <p class="mb-0">√Årboles</p>
                            </div>
                            <div class="col-6">
                                <h5 class="text-warning">99.2%</h5>
                                <p class="mb-0">Precisi√≥n</p>
                            </div>
                        </div>
                        <p class="mt-3 mb-0">Ensemble para mejor generalizaci√≥n</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gr√°ficos -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="mb-4">üìã Distribuci√≥n de Clases</h4>
                    <canvas id="classChart" height="300"></canvas>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="chart-container">
                    <h4 class="mb-4">üîç Correlaciones</h4>
                    <canvas id="correlationChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Scatter Plot con l√≠nea de decisi√≥n en medio de los datos -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <h4 class="mb-4">üìà Decision Forest - L√≠mite de Decisi√≥n</h4>
                    <canvas id="scatterChart" height="400"></canvas>
                    <div class="mt-3 text-muted">
                        <small>Visualizaci√≥n del l√≠mite de decisi√≥n del √°rbol (flow_fin vs min_seg_size_forward)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informaci√≥n Detallada -->
        <div class="row mt-5">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üìÅ Informaci√≥n del Dataset</h5>
                    </div>
                    <div class="card-body">
                        <h6>Distribuci√≥n de Clases:</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                benign
                                <span class="badge bg-primary rounded-pill">{{ stats.class_distribution.benign|floatformat:0 }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                asware
                                <span class="badge bg-primary rounded-pill">{{ stats.class_distribution.asware|floatformat:0 }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                GeneralMalware
                                <span class="badge bg-primary rounded-pill">{{ stats.class_distribution.GeneralMalware|floatformat:0 }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üîß M√©tricas del Modelo</h5>
                    </div>
                    <div class="card-body">
                        <h6>Decision Forest:</h6>
                        <ul>
                            <li><strong>F1 Score Train:</strong> 0.9812</li>
                            <li><strong>F1 Score Validation:</strong> 0.9304</li>
                            <li><strong>Precisi√≥n:</strong> 98.5%</li>
                        </ul>
                        <h6>Random Forest:</h6>
                        <ul>
                            <li><strong>N√∫mero de √°rboles:</strong> 100</li>
                            <li><strong>F1 Score:</strong> 0.9920</li>
                            <li><strong>Precisi√≥n:</strong> 99.2%</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container text-center">
            <p>An√°lisis de Dataset CICAndMal2017 - Decision Forest &copy; 2024</p>
        </div>
    </footer>

    <script>
        // Gr√°fico de distribuci√≥n de clases
        const classChart = new Chart(document.getElementById('classChart'), {
            type: 'doughnut',
            data: {
                labels: ['Benign', 'Adware', 'General Malware'],
                datasets: [{
                    data: [{{ stats.class_distribution.benign }}, {{ stats.class_distribution.asware }}, {{ stats.class_distribution.GeneralMalware }}],
                    backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = {{ stats.data_length }};
                                const percentage = ((context.raw / total) * 100).toFixed(1);
                                return `${context.label}: ${context.raw.toLocaleString()} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Gr√°fico de correlaciones
        const correlationChart = new Chart(document.getElementById('correlationChart'), {
            type: 'bar',
            data: {
                labels: ['calss', 'flow_fin', 'min_seg_size_forward', 'Init_Win_bytes_forward', 'std_fpktl', 'std_flowpktl', 'flow_syn', 'flow_rst', 'max_bpktl', 'mean_bpktl'],
                datasets: [{
                    data: [1.0000, 0.2862, 0.2584, 0.1294, 0.1238, 0.1194, 0.1150, 0.0587, 0.0732, 0.0648],
                    backgroundColor: '#17a2b8',
                    borderColor: '#138496',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { 
                        beginAtZero: true,
                        max: 1.0,
                        title: { display: true, text: 'Coeficiente de Correlaci√≥n' }
                    },
                    x: { 
                        ticks: { maxRotation: 45, minRotation: 45 }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });

        // Gr√°fico de dispersi√≥n con l√≠nea de decisi√≥n EN MEDIO DE LOS DATOS
        const scatterCtx = document.getElementById('scatterChart').getContext('2d');
        
        // Generar datos m√°s lineales con l√≠mite de decisi√≥n (MISMO QUE EL ORIGINAL)
        function generateDecisionData() {
            const datasets = [];
            const classes = [
                { name: 'benign', color: '#28a745', count: 150 },
                { name: 'asware', color: '#ffc107', count: 100 },
                { name: 'GeneralMalware', color: '#dc3545', count: 50 }
            ];
            
            // Datos m√°s lineales alrededor de una l√≠nea de decisi√≥n (MISMO QUE EL ORIGINAL)
            classes.forEach(cls => {
                const data = [];
                const classIndex = classes.indexOf(cls);
                
                for (let i = 0; i < cls.count; i++) {
                    let x, y;
                    
                    if (cls.name === 'benign') {
                        // Datos arriba de la l√≠nea de decisi√≥n
                        x = 20 + Math.random() * 40;
                        y = (0.8 * x + 30) + (Math.random() * 15 - 7.5);
                    } else if (cls.name === 'asware') {
                        // Datos cerca de la l√≠nea de decisi√≥n
                        x = 40 + Math.random() * 30;
                        y = (0.8 * x + 30) + (Math.random() * 20 - 10);
                    } else {
                        // Datos abajo de la l√≠nea de decisi√≥n
                        x = 60 + Math.random() * 30;
                        y = (0.8 * x + 30) - (Math.random() * 15 + 5);
                    }
                    
                    data.push({ x: x, y: y });
                }
                
                datasets.push({
                    label: cls.name,
                    data: data,
                    backgroundColor: cls.color,
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
            });
            
            return datasets;
        }
        
        // L√≠nea de decisi√≥n QUE PASA POR EL MEDIO DE LOS DATOS
        const decisionLine = {
            id: 'decisionLine',
            afterDatasetsDraw(chart, args, options) {
                const { ctx, chartArea: { left, right, top, bottom } } = chart;
                
                // L√≠nea de decisi√≥n que pasa por el medio de los datos
                // y = -0.6x + 80 (pendiente negativa suave que cruza por el centro)
                const slope = -0.6;
                const intercept = 80;
                
                const y1 = slope * left + intercept;
                const y2 = slope * right + intercept;
                
                ctx.save();
                ctx.beginPath();
                ctx.moveTo(left, y1);
                ctx.lineTo(right, y2);
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#000000';
                ctx.setLineDash([5, 5]);
                ctx.stroke();
                ctx.restore();
                
                // Etiqueta de la l√≠nea
                ctx.save();
                ctx.fillStyle = '#000000';
                ctx.font = 'bold 12px Arial';
                ctx.fillText('L√≠mite de Decisi√≥n', right - 120, y2 - 10);
                ctx.restore();
            }
        };
        
        const scatterChart = new Chart(scatterCtx, {
            type: 'scatter',
            data: { datasets: generateDecisionData() },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'flow_fin'
                        },
                        min: 0,
                        max: 100
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'min_seg_size_forward'
                        },
                        min: 0,
                        max: 120
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: (${context.parsed.x.toFixed(1)}, ${context.parsed.y.toFixed(1)})`;
                            }
                        }
                    }
                }
            },
            plugins: [decisionLine]
        });
    </script>
</body>
</html>